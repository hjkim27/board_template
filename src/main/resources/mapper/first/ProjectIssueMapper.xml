<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Mon May 02 17:59:21 KST 2022-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.github.hjkim27.mapper.first.ProjectIssueMapper">

    <!-- issue 정보 추가 -->
    <insert id="insertRow" parameterType="com.github.hjkim27.bean.vo.project.ProjectIssueVO">
        insert into tb_project_issue (repository_sid, label_ids, state, issue_number, title, body)
        values (#{repositorySid}, #{labelIds}, #{state}, #{issueNumber}, #{title}, #{body})
    </insert>

    <!-- issue 정보 수정 -->
    <update id="updateRow" parameterType="com.github.hjkim27.bean.vo.project.ProjectIssueVO">
        update tb_project_issue
        set label_ids = #{labelIds},
            state     = #{state},
            title     = #{title},
            body      = #{body}
        where issue_number = #{issueNumber}
    </update>

    <!-- issue 존재여부 조회 -->
    <select id="isExistRow" parameterType="com.github.hjkim27.bean.vo.project.ProjectIssueVO" resultType="Boolean">
        select count(issue_number) > 0
        from tb_project_issue
        where issue_number = #{issueNumber}
    </select>

    <!-- issue 목록 조회 -->
    <select id="getList" parameterType="com.github.hjkim27.bean.search.ProjectSearch" resultType="com.github.hjkim27.bean.dto.project.ProjectIssueDTO">
        select
            (select full_name from tb_project_repository where sid = i.repository_sid) as repository_full_name,
            state, issue_number, title, body, label_ids
        from tb_project_issue i
    </select>
</mapper>