<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Mon May 02 17:59:21 KST 2022-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.github.hjkim27.mapper.first.ProjectCommitMapper">

    <!-- commit 정보 추가 -->
    <insert id="insertRow" parameterType="com.github.hjkim27.bean.dto.project.ProjectCommitDTO"
            keyProperty="sha" keyColumn="sha">
        insert into tb_project_commit (repository_sid, sha, parent_sha, committer_name, committer_email,
                                       committer_date, message, html_url)
        values ((select sid from gh_repository where full_name = #{repositoryFullName}),
                #{sha}, #{parentSha}, #{committerName}, #{committerEmail}, #{committerDate}, #{message}, #{htmlUrl});
    </insert>

    <!-- commit 정보 수정 -->
    <update id="updateRow" parameterType="com.github.hjkim27.bean.dto.project.ProjectCommitDTO">
        update tb_project_commit
        <trim prefix="set" prefixOverrides=",">
            <if test="committerName != null and committerName!=''">
                committer_name = #{committerName},
            </if>
            <if test="committerEmail != null and committerEmail!=''">
                committer_email = #{committerEmail},
            </if>
            <if test="committerDate != null and committerDate!=''">
                committer_date = #{committerDate},
            </if>
            <if test="message != null and message!=''">
                message = #{message},
            </if>
            <if test="htmlUrl != null and htmlUrl!=''">
                html_url = #{htmlUrl},
            </if>
        </trim>
        where sha = #{sha}
    </update>

    <!-- commit 존재여부 조회 -->
    <select id="isExistRow" parameterType="com.github.hjkim27.bean.dto.project.ProjectCommitDTO" resultType="Boolean">
        select count(sha) > 0
        from tb_project_commit
        where sha = #{sha}
    </select>

</mapper>