<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Mon May 02 17:59:21 KST 2022-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.first.ProjectCommentMapper">

    <!-- comment 정보 추가 -->
    <insert id="insertRow" parameterType="com.example.demo.bean.vo.project.ProjectCommentVO"
            keyProperty="sid" keyColumn="sid" useGeneratedKeys="true">
        insert into tb_project_comment (issue_number, comment_id, body, parent_comment_id, created_at, updated_at)
        values (#{issueNumber}, #{commentId}, #{body}, #{parentCommentId}, #{createdAt}, #{updatedAt});
    </insert>

    <!-- comment 정보 수정 -->
    <update id="updateRow" parameterType="com.example.demo.bean.vo.project.ProjectCommentVO">
        update tb_project_comment
        set body              = #{body},
            parent_comment_id = #{parentCommentId},
            updated_at        = #{updatedAt}
        where comment_id = #{commentId};
    </update>

    <!-- 삭제된 comment 을 확인하기 위해 모든 repository 의 active 를 false 로 업데이트 -->
    <update id="updateActiveFalse">
        update tb_project_comment
        set active = false;
    </update>

    <!-- comment 존재여부 조회 -->
    <select id="isExistRow" parameterType="com.example.demo.bean.vo.project.ProjectCommentVO" resultType="Boolean">
        select count(comment_id) > 0
        from tb_project_comment
        where comment_id = #{commentId}
    </select>

</mapper>